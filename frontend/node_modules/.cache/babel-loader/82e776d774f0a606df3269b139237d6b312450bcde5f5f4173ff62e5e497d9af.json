{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\sabin.arsene\\\\Desktop\\\\Tudu-app\\\\TUDU\\\\frontend\\\\src\\\\components\\\\Chat\\\\Chat.jsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef, useCallback } from 'react';\nimport { Box, VStack, Input, Button, Text, Flex, HStack, IconButton, Badge, Popover, PopoverTrigger, PopoverContent, Tooltip, Spinner } from '@chakra-ui/react';\nimport { useSocket } from '../../contexts/SocketContext';\nimport axios from 'axios';\nimport { API_URL } from '../../config/api';\n\n// Corrected icon imports\nimport { Smile, CornerUpLeft } from 'react-feather';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport function Chat({\n  receiverId,\n  receiverName\n}) {\n  _s();\n  const {\n    socket\n  } = useSocket();\n  const [messages, setMessages] = useState([]);\n  const [receiverStatus, setReceiverStatus] = useState('offline');\n  const [unreadCount, setUnreadCount] = useState(0);\n  const [isWindowFocused, setIsWindowFocused] = useState(true);\n  const [newMessage, setNewMessage] = useState('');\n  const [isTyping, setIsTyping] = useState(false);\n  const [loading, setLoading] = useState(true);\n  const [replyTo, setReplyTo] = useState(null);\n  const messagesEndRef = useRef(null);\n  const typingTimeoutRef = useRef(null);\n  const loadMessages = useCallback(async () => {\n    try {\n      const response = await axios.get(`${API_URL}/messages/${receiverId}`);\n      setMessages(response.data);\n      setLoading(false);\n    } catch (error) {\n      console.error('Error loading messages:', error);\n      setLoading(false);\n    }\n  }, [receiverId]);\n  const handleFocus = useCallback(() => setIsWindowFocused(true), []);\n  const handleBlur = useCallback(() => setIsWindowFocused(false), []);\n  useEffect(() => {\n    window.addEventListener('focus', handleFocus);\n    window.addEventListener('blur', handleBlur);\n    return () => {\n      window.removeEventListener('focus', handleFocus);\n      window.removeEventListener('blur', handleBlur);\n    };\n  }, [handleFocus, handleBlur]);\n  useEffect(() => {\n    loadMessages();\n  }, [loadMessages]);\n  useEffect(() => {\n    if (socket) {\n      const handleUserStatus = data => {\n        if (data.userId === receiverId) {\n          setReceiverStatus(data.status);\n        }\n      };\n      socket.on('user_status', handleUserStatus);\n      socket.emit('get_user_status', receiverId);\n      return () => {\n        socket.off('user_status', handleUserStatus);\n      };\n    }\n  }, [socket, receiverId]);\n  useEffect(() => {\n    if (messagesEndRef.current) {\n      messagesEndRef.current.scrollIntoView({\n        behavior: 'smooth'\n      });\n    }\n  }, [messages]);\n  useEffect(() => {\n    if (socket && socket.connected) {\n      socket.emit('join_chat', receiverId);\n      const handleReceiveMessage = data => {\n        setMessages(prev => {\n          // Avoid duplicate messages\n          if (prev.some(msg => msg.id === data.id)) {\n            return prev;\n          }\n          return [...prev, data];\n        });\n        if (!isWindowFocused) {\n          setUnreadCount(prev => prev + 1);\n        }\n      };\n      const handleUserTyping = userId => {\n        if (userId === receiverId) {\n          setIsTyping(true);\n          setTimeout(() => setIsTyping(false), 3000);\n        }\n      };\n      socket.on('receive_message', handleReceiveMessage);\n      socket.on('user_typing', handleUserTyping);\n      return () => {\n        socket.off('receive_message', handleReceiveMessage);\n        socket.off('user_typing', handleUserTyping);\n        socket.emit('leave_chat', receiverId);\n      };\n    }\n  }, [socket, receiverId, isWindowFocused]);\n  useEffect(() => {\n    if (isWindowFocused && unreadCount > 0 && socket) {\n      setUnreadCount(0);\n      // Mark messages as read\n      messages.filter(msg => !msg.read_at && msg.sender_id === receiverId).forEach(msg => {\n        socket.emit('message_read', {\n          messageId: msg.id,\n          userId: localStorage.getItem('userId'),\n          senderId: msg.sender_id\n        });\n      });\n    }\n  }, [isWindowFocused, messages, unreadCount, receiverId, socket]);\n  const handleTyping = useCallback(() => {\n    if (socket) {\n      socket.emit('typing', receiverId);\n    }\n    if (typingTimeoutRef.current) {\n      clearTimeout(typingTimeoutRef.current);\n    }\n    typingTimeoutRef.current = setTimeout(() => {\n      if (socket) {\n        socket.emit('stop_typing', receiverId);\n      }\n    }, 2000);\n  }, [socket, receiverId]);\n  const handleSend = useCallback(async () => {\n    if (!newMessage.trim() || !(socket !== null && socket !== void 0 && socket.connected)) return;\n    try {\n      const messageData = {\n        content: newMessage,\n        receiverId,\n        replyTo: replyTo === null || replyTo === void 0 ? void 0 : replyTo.id,\n        senderId: localStorage.getItem('userId')\n      };\n      const response = await axios.post(`${API_URL}/messages`, messageData);\n      if (socket !== null && socket !== void 0 && socket.connected) {\n        socket.emit('send_message', {\n          ...response.data,\n          receiverId\n        });\n        setMessages(prev => [...prev, response.data]);\n        setNewMessage('');\n        setReplyTo(null);\n      }\n    } catch (error) {\n      console.error('Error sending message:', error);\n    }\n  }, [newMessage, socket, receiverId, replyTo]);\n  const reactions = ['👍', '❤️', '😊', '😂', '😮', '😢'];\n  const handleReaction = useCallback(async (messageId, reaction) => {\n    try {\n      await axios.post(`${API_URL}/messages/${messageId}/reactions`, {\n        reaction\n      });\n      if (socket) {\n        socket.emit('message_reaction', {\n          messageId,\n          reaction,\n          receiverId\n        });\n      }\n    } catch (error) {\n      console.error('Error adding reaction:', error);\n    }\n  }, [socket, receiverId]);\n  const handleReply = useCallback(message => {\n    setReplyTo(message);\n    // Focus on input\n    document.querySelector('#messageInput').focus();\n  }, []);\n  if (loading) {\n    return /*#__PURE__*/_jsxDEV(Box, {\n      display: \"flex\",\n      justifyContent: \"center\",\n      alignItems: \"center\",\n      h: \"100%\",\n      children: /*#__PURE__*/_jsxDEV(Spinner, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 196,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 195,\n      columnNumber: 7\n    }, this);\n  }\n  const MessageBubble = ({\n    message\n  }) => {\n    var _messages$find, _message$reactions;\n    return /*#__PURE__*/_jsxDEV(Box, {\n      position: \"relative\",\n      maxW: \"70%\",\n      children: [message.reply_to && /*#__PURE__*/_jsxDEV(Box, {\n        borderLeftWidth: \"2px\",\n        borderLeftColor: \"gray.300\",\n        pl: 2,\n        mb: 1,\n        opacity: 0.7,\n        children: /*#__PURE__*/_jsxDEV(Text, {\n          fontSize: \"sm\",\n          children: (_messages$find = messages.find(m => m.id === message.reply_to)) === null || _messages$find === void 0 ? void 0 : _messages$find.content\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 211,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 204,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Box, {\n        bg: message.sender_id === parseInt(localStorage.getItem('userId')) ? 'blue.500' : 'gray.200',\n        color: message.sender_id === parseInt(localStorage.getItem('userId')) ? 'white' : 'black',\n        borderRadius: \"lg\",\n        px: 3,\n        py: 2,\n        children: [/*#__PURE__*/_jsxDEV(Text, {\n          children: message.content\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 221,\n          columnNumber: 9\n        }, this), ((_message$reactions = message.reactions) === null || _message$reactions === void 0 ? void 0 : _message$reactions.length) > 0 && /*#__PURE__*/_jsxDEV(HStack, {\n          spacing: 1,\n          mt: 1,\n          children: Object.entries(message.reactions.reduce((acc, r) => ({\n            ...acc,\n            [r.reaction]: (acc[r.reaction] || 0) + 1\n          }), {})).map(([reaction, count]) => /*#__PURE__*/_jsxDEV(Badge, {\n            variant: \"subtle\",\n            colorScheme: \"gray\",\n            children: [reaction, \" \", count]\n          }, reaction, true, {\n            fileName: _jsxFileName,\n            lineNumber: 230,\n            columnNumber: 15\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 223,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 214,\n        columnNumber: 7\n      }, this), /*#__PURE__*/_jsxDEV(HStack, {\n        position: \"absolute\",\n        right: 2,\n        bottom: -6,\n        opacity: 0,\n        _groupHover: {\n          opacity: 1\n        },\n        transition: \"0.2s\",\n        children: [/*#__PURE__*/_jsxDEV(Popover, {\n          placement: \"top\",\n          children: [/*#__PURE__*/_jsxDEV(PopoverTrigger, {\n            children: /*#__PURE__*/_jsxDEV(IconButton, {\n              size: \"xs\",\n              icon: /*#__PURE__*/_jsxDEV(Smile, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 240,\n                columnNumber: 41\n              }, this),\n              variant: \"ghost\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 240,\n              columnNumber: 13\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 239,\n            columnNumber: 11\n          }, this), /*#__PURE__*/_jsxDEV(PopoverContent, {\n            w: \"auto\",\n            p: 2,\n            children: /*#__PURE__*/_jsxDEV(HStack, {\n              children: reactions.map(reaction => /*#__PURE__*/_jsxDEV(Box, {\n                cursor: \"pointer\",\n                p: 1,\n                _hover: {\n                  bg: 'gray.100'\n                },\n                onClick: () => handleReaction(message.id, reaction),\n                children: reaction\n              }, reaction, false, {\n                fileName: _jsxFileName,\n                lineNumber: 245,\n                columnNumber: 17\n              }, this))\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 243,\n              columnNumber: 13\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 242,\n            columnNumber: 11\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 238,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(Tooltip, {\n          label: \"Reply\",\n          children: /*#__PURE__*/_jsxDEV(IconButton, {\n            size: \"xs\",\n            icon: /*#__PURE__*/_jsxDEV(CornerUpLeft, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 261,\n              columnNumber: 19\n            }, this),\n            variant: \"ghost\",\n            onClick: () => handleReply(message)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 259,\n            columnNumber: 11\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 258,\n          columnNumber: 9\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 237,\n        columnNumber: 7\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 202,\n      columnNumber: 5\n    }, this);\n  };\n  return /*#__PURE__*/_jsxDEV(Box, {\n    h: \"100%\",\n    display: \"flex\",\n    flexDirection: \"column\",\n    children: [/*#__PURE__*/_jsxDEV(Box, {\n      p: 4,\n      bg: \"gray.100\",\n      borderBottom: \"1px\",\n      borderColor: \"gray.200\",\n      children: /*#__PURE__*/_jsxDEV(Flex, {\n        justify: \"space-between\",\n        align: \"center\",\n        children: [/*#__PURE__*/_jsxDEV(Text, {\n          fontWeight: \"bold\",\n          children: receiverName\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 274,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Badge, {\n          colorScheme: receiverStatus === 'online' ? 'green' : 'gray',\n          children: receiverStatus\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 275,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 273,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 272,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(VStack, {\n      flex: 1,\n      p: 4,\n      spacing: 4,\n      overflowY: \"auto\",\n      children: [messages.map(message => /*#__PURE__*/_jsxDEV(MessageBubble, {\n        message: message\n      }, message.id, false, {\n        fileName: _jsxFileName,\n        lineNumber: 283,\n        columnNumber: 11\n      }, this)), isTyping && /*#__PURE__*/_jsxDEV(Text, {\n        color: \"gray.500\",\n        fontSize: \"sm\",\n        alignSelf: \"flex-start\",\n        children: [receiverName, \" is typing...\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 286,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        ref: messagesEndRef\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 290,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 281,\n      columnNumber: 7\n    }, this), replyTo && /*#__PURE__*/_jsxDEV(Box, {\n      p: 2,\n      bg: \"gray.50\",\n      borderTop: \"1px\",\n      borderColor: \"gray.200\",\n      children: /*#__PURE__*/_jsxDEV(Flex, {\n        justify: \"space-between\",\n        align: \"center\",\n        children: [/*#__PURE__*/_jsxDEV(Text, {\n          fontSize: \"sm\",\n          color: \"gray.600\",\n          children: [\"Replying to: \", replyTo.content]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 296,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(IconButton, {\n          icon: /*#__PURE__*/_jsxDEV(CornerUpLeft, {\n            size: 16\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 298,\n            columnNumber: 21\n          }, this),\n          size: \"sm\",\n          variant: \"ghost\",\n          onClick: () => setReplyTo(null)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 297,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 295,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 294,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(Box, {\n      p: 4,\n      borderTop: \"1px\",\n      borderColor: \"gray.200\",\n      children: /*#__PURE__*/_jsxDEV(Flex, {\n        children: [/*#__PURE__*/_jsxDEV(Input, {\n          id: \"messageInput\",\n          value: newMessage,\n          onChange: e => {\n            setNewMessage(e.target.value);\n            handleTyping();\n          },\n          placeholder: \"Type a message...\",\n          mr: 2\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 309,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Popover, {\n          children: [/*#__PURE__*/_jsxDEV(PopoverTrigger, {\n            children: /*#__PURE__*/_jsxDEV(IconButton, {\n              icon: /*#__PURE__*/_jsxDEV(Smile, {\n                size: 20\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 321,\n                columnNumber: 33\n              }, this),\n              variant: \"ghost\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 321,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 320,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(PopoverContent, {\n            p: 2,\n            children: /*#__PURE__*/_jsxDEV(Flex, {\n              wrap: \"wrap\",\n              gap: 2,\n              children: reactions.map(reaction => /*#__PURE__*/_jsxDEV(Button, {\n                size: \"sm\",\n                variant: \"ghost\",\n                onClick: () => {\n                  setNewMessage(prev => prev + reaction);\n                  document.querySelector('#messageInput').focus();\n                },\n                children: reaction\n              }, reaction, false, {\n                fileName: _jsxFileName,\n                lineNumber: 326,\n                columnNumber: 19\n              }, this))\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 324,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 323,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 319,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          ml: 2,\n          colorScheme: \"blue\",\n          onClick: handleSend,\n          children: \"Send\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 341,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 308,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 307,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 271,\n    columnNumber: 5\n  }, this);\n}\n_s(Chat, \"inywfcJJtJV4W+mEphPGfq2voo8=\", false, function () {\n  return [useSocket];\n});\n_c = Chat;\nvar _c;\n$RefreshReg$(_c, \"Chat\");","map":{"version":3,"names":["React","useState","useEffect","useRef","useCallback","Box","VStack","Input","Button","Text","Flex","HStack","IconButton","Badge","Popover","PopoverTrigger","PopoverContent","Tooltip","Spinner","useSocket","axios","API_URL","Smile","CornerUpLeft","jsxDEV","_jsxDEV","Chat","receiverId","receiverName","_s","socket","messages","setMessages","receiverStatus","setReceiverStatus","unreadCount","setUnreadCount","isWindowFocused","setIsWindowFocused","newMessage","setNewMessage","isTyping","setIsTyping","loading","setLoading","replyTo","setReplyTo","messagesEndRef","typingTimeoutRef","loadMessages","response","get","data","error","console","handleFocus","handleBlur","window","addEventListener","removeEventListener","handleUserStatus","userId","status","on","emit","off","current","scrollIntoView","behavior","connected","handleReceiveMessage","prev","some","msg","id","handleUserTyping","setTimeout","filter","read_at","sender_id","forEach","messageId","localStorage","getItem","senderId","handleTyping","clearTimeout","handleSend","trim","messageData","content","post","reactions","handleReaction","reaction","handleReply","message","document","querySelector","focus","display","justifyContent","alignItems","h","children","fileName","_jsxFileName","lineNumber","columnNumber","MessageBubble","_messages$find","_message$reactions","position","maxW","reply_to","borderLeftWidth","borderLeftColor","pl","mb","opacity","fontSize","find","m","bg","parseInt","color","borderRadius","px","py","length","spacing","mt","Object","entries","reduce","acc","r","map","count","variant","colorScheme","right","bottom","_groupHover","transition","placement","size","icon","w","p","cursor","_hover","onClick","label","flexDirection","borderBottom","borderColor","justify","align","fontWeight","flex","overflowY","alignSelf","ref","borderTop","value","onChange","e","target","placeholder","mr","wrap","gap","ml","_c","$RefreshReg$"],"sources":["C:/Users/sabin.arsene/Desktop/Tudu-app/TUDU/frontend/src/components/Chat/Chat.jsx"],"sourcesContent":["import React, { useState, useEffect, useRef, useCallback } from 'react';\r\nimport { \r\n  Box, VStack, Input, Button, Text, Flex, HStack, \r\n  IconButton, Badge, Popover, PopoverTrigger, \r\n  PopoverContent, Tooltip, Spinner\r\n} from '@chakra-ui/react';\r\nimport { useSocket } from '../../contexts/SocketContext';\r\nimport axios from 'axios';\r\nimport { API_URL } from '../../config/api';\r\n\r\n// Corrected icon imports\r\nimport { Smile, CornerUpLeft } from 'react-feather';\r\n\r\nexport function Chat({ receiverId, receiverName }) {\r\n  const { socket } = useSocket();\r\n  const [messages, setMessages] = useState([]);\r\n  const [receiverStatus, setReceiverStatus] = useState('offline');\r\n  const [unreadCount, setUnreadCount] = useState(0);\r\n  const [isWindowFocused, setIsWindowFocused] = useState(true);\r\n  const [newMessage, setNewMessage] = useState('');\r\n  const [isTyping, setIsTyping] = useState(false);\r\n  const [loading, setLoading] = useState(true);\r\n  const [replyTo, setReplyTo] = useState(null);\r\n  \r\n  const messagesEndRef = useRef(null);\r\n  const typingTimeoutRef = useRef(null);\r\n\r\n  const loadMessages = useCallback(async () => {\r\n    try {\r\n      const response = await axios.get(`${API_URL}/messages/${receiverId}`);\r\n      setMessages(response.data);\r\n      setLoading(false);\r\n    } catch (error) {\r\n      console.error('Error loading messages:', error);\r\n      setLoading(false);\r\n    }\r\n  }, [receiverId]);\r\n\r\n  const handleFocus = useCallback(() => setIsWindowFocused(true), []);\r\n  const handleBlur = useCallback(() => setIsWindowFocused(false), []);\r\n\r\n  useEffect(() => {\r\n    window.addEventListener('focus', handleFocus);\r\n    window.addEventListener('blur', handleBlur);\r\n\r\n    return () => {\r\n      window.removeEventListener('focus', handleFocus);\r\n      window.removeEventListener('blur', handleBlur);\r\n    };\r\n  }, [handleFocus, handleBlur]);\r\n\r\n  useEffect(() => {\r\n    loadMessages();\r\n  }, [loadMessages]);\r\n\r\n  useEffect(() => {\r\n    if (socket) {\r\n      const handleUserStatus = (data) => {\r\n        if (data.userId === receiverId) {\r\n          setReceiverStatus(data.status);\r\n        }\r\n      };\r\n\r\n      socket.on('user_status', handleUserStatus);\r\n      socket.emit('get_user_status', receiverId);\r\n\r\n      return () => {\r\n        socket.off('user_status', handleUserStatus);\r\n      };\r\n    }\r\n  }, [socket, receiverId]);\r\n\r\n  useEffect(() => {\r\n    if (messagesEndRef.current) {\r\n      messagesEndRef.current.scrollIntoView({ behavior: 'smooth' });\r\n    }\r\n  }, [messages]);\r\n\r\n  useEffect(() => {\r\n    if (socket && socket.connected) {\r\n      socket.emit('join_chat', receiverId);\r\n      \r\n      const handleReceiveMessage = (data) => {\r\n        setMessages(prev => {\r\n          // Avoid duplicate messages\r\n          if (prev.some(msg => msg.id === data.id)) {\r\n            return prev;\r\n          }\r\n          return [...prev, data];\r\n        });\r\n        \r\n        if (!isWindowFocused) {\r\n          setUnreadCount(prev => prev + 1);\r\n        }\r\n      };\r\n\r\n      const handleUserTyping = (userId) => {\r\n        if (userId === receiverId) {\r\n          setIsTyping(true);\r\n          setTimeout(() => setIsTyping(false), 3000);\r\n        }\r\n      };\r\n\r\n      socket.on('receive_message', handleReceiveMessage);\r\n      socket.on('user_typing', handleUserTyping);\r\n\r\n      return () => {\r\n        socket.off('receive_message', handleReceiveMessage);\r\n        socket.off('user_typing', handleUserTyping);\r\n        socket.emit('leave_chat', receiverId);\r\n      };\r\n    }\r\n  }, [socket, receiverId, isWindowFocused]);\r\n\r\n  useEffect(() => {\r\n    if (isWindowFocused && unreadCount > 0 && socket) {\r\n      setUnreadCount(0);\r\n      // Mark messages as read\r\n      messages\r\n        .filter(msg => !msg.read_at && msg.sender_id === receiverId)\r\n        .forEach(msg => {\r\n          socket.emit('message_read', {\r\n            messageId: msg.id,\r\n            userId: localStorage.getItem('userId'),\r\n            senderId: msg.sender_id\r\n          });\r\n        });\r\n    }\r\n  }, [isWindowFocused, messages, unreadCount, receiverId, socket]);\r\n\r\n  const handleTyping = useCallback(() => {\r\n    if (socket) {\r\n      socket.emit('typing', receiverId);\r\n    }\r\n\r\n    if (typingTimeoutRef.current) {\r\n      clearTimeout(typingTimeoutRef.current);\r\n    }\r\n\r\n    typingTimeoutRef.current = setTimeout(() => {\r\n      if (socket) {\r\n        socket.emit('stop_typing', receiverId);\r\n      }\r\n    }, 2000);\r\n  }, [socket, receiverId]);\r\n\r\n  const handleSend = useCallback(async () => {\r\n    if (!newMessage.trim() || !socket?.connected) return;\r\n\r\n    try {\r\n      const messageData = {\r\n        content: newMessage,\r\n        receiverId,\r\n        replyTo: replyTo?.id,\r\n        senderId: localStorage.getItem('userId')\r\n      };\r\n\r\n      const response = await axios.post(`${API_URL}/messages`, messageData);\r\n      \r\n      if (socket?.connected) {\r\n        socket.emit('send_message', { ...response.data, receiverId });\r\n        setMessages(prev => [...prev, response.data]);\r\n        setNewMessage('');\r\n        setReplyTo(null);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error sending message:', error);\r\n    }\r\n  }, [newMessage, socket, receiverId, replyTo]);\r\n\r\n  const reactions = ['👍', '❤️', '😊', '😂', '😮', '😢'];\r\n\r\n  const handleReaction = useCallback(async (messageId, reaction) => {\r\n    try {\r\n      await axios.post(`${API_URL}/messages/${messageId}/reactions`, {\r\n        reaction\r\n      });\r\n      \r\n      if (socket) {\r\n        socket.emit('message_reaction', { messageId, reaction, receiverId });\r\n      }\r\n    } catch (error) {\r\n      console.error('Error adding reaction:', error);\r\n    }\r\n  }, [socket, receiverId]);\r\n\r\n  const handleReply = useCallback((message) => {\r\n    setReplyTo(message);\r\n    // Focus on input\r\n    document.querySelector('#messageInput').focus();\r\n  }, []);\r\n\r\n  if (loading) {\r\n    return (\r\n      <Box display=\"flex\" justifyContent=\"center\" alignItems=\"center\" h=\"100%\">\r\n        <Spinner />\r\n      </Box>\r\n    );\r\n  }\r\n\r\n  const MessageBubble = ({ message }) => (\r\n    <Box position=\"relative\" maxW=\"70%\">\r\n      {message.reply_to && (\r\n        <Box \r\n          borderLeftWidth=\"2px\" \r\n          borderLeftColor=\"gray.300\" \r\n          pl={2} \r\n          mb={1}\r\n          opacity={0.7}\r\n        >\r\n          <Text fontSize=\"sm\">{messages.find(m => m.id === message.reply_to)?.content}</Text>\r\n        </Box>\r\n      )}\r\n      <Box\r\n        bg={message.sender_id === parseInt(localStorage.getItem('userId')) ? 'blue.500' : 'gray.200'}\r\n        color={message.sender_id === parseInt(localStorage.getItem('userId')) ? 'white' : 'black'}\r\n        borderRadius=\"lg\"\r\n        px={3}\r\n        py={2}\r\n      >\r\n        <Text>{message.content}</Text>\r\n        {message.reactions?.length > 0 && (\r\n          <HStack spacing={1} mt={1}>\r\n            {Object.entries(\r\n              message.reactions.reduce((acc, r) => ({\r\n                ...acc,\r\n                [r.reaction]: (acc[r.reaction] || 0) + 1\r\n              }), {})\r\n            ).map(([reaction, count]) => (\r\n              <Badge key={reaction} variant=\"subtle\" colorScheme=\"gray\">\r\n                {reaction} {count}\r\n              </Badge>\r\n            ))}\r\n          </HStack>\r\n        )}\r\n      </Box>\r\n      <HStack position=\"absolute\" right={2} bottom={-6} opacity={0} _groupHover={{ opacity: 1 }} transition=\"0.2s\">\r\n        <Popover placement=\"top\">\r\n          <PopoverTrigger>\r\n            <IconButton size=\"xs\" icon={<Smile />} variant=\"ghost\" />\r\n          </PopoverTrigger>\r\n          <PopoverContent w=\"auto\" p={2}>\r\n            <HStack>\r\n              {reactions.map(reaction => (\r\n                <Box\r\n                  key={reaction}\r\n                  cursor=\"pointer\"\r\n                  p={1}\r\n                  _hover={{ bg: 'gray.100' }}\r\n                  onClick={() => handleReaction(message.id, reaction)}\r\n                >\r\n                  {reaction}\r\n                </Box>\r\n              ))}\r\n            </HStack>\r\n          </PopoverContent>\r\n        </Popover>\r\n        <Tooltip label=\"Reply\">\r\n          <IconButton \r\n            size=\"xs\" \r\n            icon={<CornerUpLeft />} \r\n            variant=\"ghost\"\r\n            onClick={() => handleReply(message)}\r\n          />\r\n        </Tooltip>\r\n      </HStack>\r\n    </Box>\r\n  );\r\n\r\n  return (\r\n    <Box h=\"100%\" display=\"flex\" flexDirection=\"column\">\r\n      <Box p={4} bg=\"gray.100\" borderBottom=\"1px\" borderColor=\"gray.200\">\r\n        <Flex justify=\"space-between\" align=\"center\">\r\n          <Text fontWeight=\"bold\">{receiverName}</Text>\r\n          <Badge colorScheme={receiverStatus === 'online' ? 'green' : 'gray'}>\r\n            {receiverStatus}\r\n          </Badge>\r\n        </Flex>\r\n      </Box>\r\n\r\n      <VStack flex={1} p={4} spacing={4} overflowY=\"auto\">\r\n        {messages.map((message) => (\r\n          <MessageBubble key={message.id} message={message} />\r\n        ))}\r\n        {isTyping && (\r\n          <Text color=\"gray.500\" fontSize=\"sm\" alignSelf=\"flex-start\">\r\n            {receiverName} is typing...\r\n          </Text>\r\n        )}\r\n        <div ref={messagesEndRef} />\r\n      </VStack>\r\n\r\n      {replyTo && (\r\n        <Box p={2} bg=\"gray.50\" borderTop=\"1px\" borderColor=\"gray.200\">\r\n          <Flex justify=\"space-between\" align=\"center\">\r\n            <Text fontSize=\"sm\" color=\"gray.600\">Replying to: {replyTo.content}</Text>\r\n            <IconButton\r\n              icon={<CornerUpLeft size={16} />}\r\n              size=\"sm\"\r\n              variant=\"ghost\"\r\n              onClick={() => setReplyTo(null)}\r\n            />\r\n          </Flex>\r\n        </Box>\r\n      )}\r\n\r\n      <Box p={4} borderTop=\"1px\" borderColor=\"gray.200\">\r\n        <Flex>\r\n          <Input\r\n            id=\"messageInput\"\r\n            value={newMessage}\r\n            onChange={(e) => {\r\n              setNewMessage(e.target.value);\r\n              handleTyping();\r\n            }}\r\n            placeholder=\"Type a message...\"\r\n            mr={2}\r\n          />\r\n          <Popover>\r\n            <PopoverTrigger>\r\n              <IconButton icon={<Smile size={20} />} variant=\"ghost\" />\r\n            </PopoverTrigger>\r\n            <PopoverContent p={2}>\r\n              <Flex wrap=\"wrap\" gap={2}>\r\n                {reactions.map((reaction) => (\r\n                  <Button\r\n                    key={reaction}\r\n                    size=\"sm\"\r\n                    variant=\"ghost\"\r\n                    onClick={() => {\r\n                      setNewMessage(prev => prev + reaction);\r\n                      document.querySelector('#messageInput').focus();\r\n                    }}\r\n                  >\r\n                    {reaction}\r\n                  </Button>\r\n                ))}\r\n              </Flex>\r\n            </PopoverContent>\r\n          </Popover>\r\n          <Button ml={2} colorScheme=\"blue\" onClick={handleSend}>\r\n            Send\r\n          </Button>\r\n        </Flex>\r\n      </Box>\r\n    </Box>\r\n  );\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}